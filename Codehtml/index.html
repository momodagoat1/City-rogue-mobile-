<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2D GTA Mobile Multiplayer</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #222;
    touch-action: none;
  }
  canvas {
    display: block;
    background: #333;
  }
  /* On-screen joystick */
  #joystick {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    touch-action: none;
  }
  #stick {
    position: absolute;
    width: 40px;
    height: 40px;
    left: 30px;
    top: 30px;
    border-radius: 50%;
    background: rgba(255,255,255,0.5);
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="joystick"><div id="stick"></div></div>

<script>
// ====== SETTINGS ======
const WS_URL = "wss://your-server-address-here"; // Replace with your WebSocket server URL
const PLAYER_SPEED = 2;

// ====== CANVAS SETUP ======
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// ====== PLAYER STATE ======
let players = {};
let myId = null;
let pos = { x: 200, y: 200 };

// ====== WEBSOCKET ======
let ws;
function connectWS() {
  ws = new WebSocket(WS_URL);

  ws.onopen = () => console.log("Connected to server");

  ws.onmessage = (msg) => {
    const data = JSON.parse(msg.data);
    if (data.type === 'init') {
      myId = data.id;
    } else if (data.type === 'update') {
      players = data.players;
    }
  };

  ws.onclose = () => {
    console.log("Disconnected. Reconnecting in 3s...");
    setTimeout(connectWS, 3000);
  };
}
connectWS();

// ====== JOYSTICK ======
const joystick = document.getElementById('joystick');
const stick = document.getElementById('stick');
let joyActive = false;
let joyCenter = { x: 0, y: 0 };
let joyVector = { x: 0, y: 0 };

joystick.addEventListener('touchstart', (e) => {
  joyActive = true;
  const touch = e.touches[0];
  joyCenter.x = touch.clientX;
  joyCenter.y = touch.clientY;
}, { passive: false });

joystick.addEventListener('touchmove', (e) => {
  if (!joyActive) return;
  const touch = e.touches[0];
  joyVector.x = touch.clientX - joyCenter.x;
  joyVector.y = touch.clientY - joyCenter.y;

  const maxDist = 40;
  const dist = Math.hypot(joyVector.x, joyVector.y);
  if (dist > maxDist) {
    joyVector.x *= maxDist / dist;
    joyVector.y *= maxDist / dist;
  }

  stick.style.transform = `translate(${joyVector.x}px, ${joyVector.y}px)`;
}, { passive: false });

joystick.addEventListener('touchend', () => {
  joyActive = false;
  joyVector.x = 0;
  joyVector.y = 0;
  stick.style.transform = `translate(0px, 0px)`;
}, { passive: false });

// ====== GAME LOOP ======
function update() {
  pos.x += (joyVector.x / 40) * PLAYER_SPEED;
  pos.y += (joyVector.y / 40) * PLAYER_SPEED;

  if (ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify({ type: 'move', x: pos.x, y: pos.y }));
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (let id in players) {
    const p = players[id];
    ctx.fillStyle = id === myId ? "red" : "blue";
    ctx.beginPath();
    ctx.arc(p.x, p.y, 20, 0, Math.PI * 2);
    ctx.fill();
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
